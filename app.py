import streamlit as st
from PIL import Image
import numpy as np
import time
import utilities



page = st.sidebar.selectbox('Choose service',['Home','Upload Image','Upload Exe','Download Image'])

st.sidebar.markdown("""_____""")
#st.sidebar.image("assets/logo1.jpg",width=300)


if page == "Home":
    st.title(":blue[Malware Classifier]")
    st.image('assets/logo2.jpg')
    st.text("\
    Malware is used by attackers to breach computer security.Nowadays,attackers \n\
    have started to adopt newer methods to propagate malware infection.\n\
    Increasing malware attacks demand better techniques for their detection.\n")

    st.text("\
    The Proposed system is a CNN based malware analysis technique.\n\
    Windowâ€™s portable executable files are converted into gray scale images with\n\
    the perception that similar malware families generally show the same\n\
    characteristics when represented as visual images. Gray scale images serve as\n\
    input to the customized Deep CNN architecture")

    st.subheader("Malware-to-Image Conversion")
    st.image("assets/docimg.png")
if page == "Upload Image":
    st.title(":blue[Upload Malware Image]")
    file = st.file_uploader("upload image of type png",type=["png"],accept_multiple_files=False)
    if file:
        img = Image.open(file)
        st.image(img)
        img_arr = img.convert("RGB")
        img_arr = np.array(img_arr.resize((64,64)))
        img_arr = img_arr.reshape([64,64,3])
        img_arr = img_arr.astype('float32')
        img_arr = img_arr.reshape(-1,64,64,3)
        img_arr = img_arr / np.max(img_arr)
        btn_state = st.button("get malware class")
        if btn_state:
            with st.spinner("model loading image"):
                time.sleep(3)
            result = utilities.get_prediction(img_arr)
            st.balloons()
            st.write("model loaded successfully malware is of class")
            st.write(result)
    else:
        print("please upload an image")
if page == "Upload Exe":
    st.write(":red[this feature is under construction]")
if page == "Download Image":
    st.subheader("Download Malware Images")
    col1 ,col2 = st.columns(2)
    with col1:
        st.text("Adialer.C")
        st.image("assets/samples/Adialer.C.png")
        st.download_button("download","assets/samples/Adialer.C.png",file_name='Adialer.C.png')
    with col2:
        st.text("Allaple.A")
        st.image("assets/samples/Allaple.A.png")
        st.download_button("download","assets/samples/Allaple.A.png",file_name='Allaple.A.png')
    col3, col4 = st.columns(2)
    with col3:
        st.text("Fakerean")
        st.image("assets/samples/Fakerean.png")
        st.download_button("download","assets/samples/Fakerean.png",file_name='Fakerean.png')
    with col4:
        st.text("Yuner.A")
        st.image("assets/samples/Yuner.A.png")
        st.download_button("download","assets/samples/Yuner.A.png",file_name='Yuner.A.png')
    

    
    